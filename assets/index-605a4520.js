var O=Object.defineProperty;var I=(o,t,e)=>t in o?O(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var n=(o,t,e)=>(I(o,typeof t!="symbol"?t+"":t,e),e);import{p as A}from"./phaser-f8c8a439.js";import{c as M,_ as B}from"./supabase-2481e69c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();class $ extends A.Scene{constructor(){super({key:"BootScene"})}preload(){console.log("üîß BootScene: Starting asset loading..."),this.createLoadingUI(),this.load.image("bottle","data:image/svg+xml;base64,"+btoa(`
      <svg width="20" height="40" xmlns="http://www.w3.org/2000/svg">
        <rect width="20" height="40" fill="#8B4513" stroke="#654321" stroke-width="2"/>
        <rect x="5" y="5" width="10" height="30" fill="#A0522D"/>
      </svg>
    `)),this.load.image("bottle_green","data:image/svg+xml;base64,"+btoa(`
      <svg width="20" height="40" xmlns="http://www.w3.org/2000/svg">
        <rect width="20" height="40" fill="#228B22" stroke="#006400" stroke-width="2"/>
        <rect x="5" y="5" width="10" height="30" fill="#32CD32"/>
        <text x="10" y="25" text-anchor="middle" fill="white" font-size="10">X</text>
      </svg>
    `)),this.load.image("powerup_star","data:image/svg+xml;base64,"+btoa(`
      <svg width="30" height="30" xmlns="http://www.w3.org/2000/svg">
        <polygon points="15,2 18,10 27,10 20,16 23,25 15,20 7,25 10,16 3,10 12,10"
                 fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
        <circle cx="15" cy="15" r="3" fill="#FFFF00"/>
      </svg>
    `)),this.load.image("charlie","/characters/charlie.png"),this.load.image("scrocca","/characters/scrocca.png"),this.load.image("leprecauno","/characters/leprecauno.png"),this.load.on("loaderror",t=>{console.error("‚ùå Asset loading error:",t.key,t.src),(t.key.startsWith("charlie")||t.key.startsWith("scrocca")||t.key.startsWith("leprecauno"))&&(console.warn("‚ö†Ô∏è Character asset failed, creating fallback sprite"),this.createFallbackCharacterSprite(t.key))}),this.load.image("bucket","data:image/svg+xml;base64,"+btoa(`
      <svg width="80" height="60" xmlns="http://www.w3.org/2000/svg">
        <path d="M10,20 L70,20 L65,55 L15,55 Z" fill="#888888" stroke="#666666" stroke-width="2"/>
        <rect x="10" y="15" width="60" height="10" fill="#AAAAAA"/>
      </svg>
    `)),this.load.image("background","data:image/svg+xml;base64,"+btoa(`
      <svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#E0F6FF;stop-opacity:1" />
          </linearGradient>
        </defs>
        <rect width="800" height="600" fill="url(#skyGradient)"/>
      </svg>
    `))}create(){console.log("‚úÖ BootScene: Assets loaded, transitioning to GameScene"),this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("GameScene")})}createLoadingUI(){const{width:t,height:e}=this.cameras.main,i=this.add.text(t/2,e/2-50,"Loading...",{fontSize:"32px",color:"#ffffff",fontFamily:"Arial"}).setOrigin(.5),r=this.add.graphics();r.fillStyle(0,.3),r.fillRect(t/2-150,e/2,300,20);const a=this.add.graphics();this.load.on("progress",s=>{a.clear(),a.fillStyle(65280),a.fillRect(t/2-150,e/2,300*s,20)}),this.load.on("complete",()=>{i.setText("Ready!"),a.clear(),r.clear()})}createFallbackCharacterSprite(t){const e={charlie:`<svg width="64" height="64" xmlns="http://www.w3.org/2000/svg">
        <circle cx="32" cy="32" r="25" fill="#FF6B6B" stroke="#000" stroke-width="2"/>
        <circle cx="25" cy="25" r="3" fill="#000"/>
        <circle cx="39" cy="25" r="3" fill="#000"/>
        <path d="M25,40 Q32,45 39,40" stroke="#000" stroke-width="2" fill="none"/>
        <text x="32" y="55" text-anchor="middle" font-size="8" fill="#000">Charlie</text>
      </svg>`,scrocca:`<svg width="64" height="64" xmlns="http://www.w3.org/2000/svg">
        <circle cx="32" cy="32" r="25" fill="#4ECDC4" stroke="#000" stroke-width="2"/>
        <circle cx="25" cy="25" r="3" fill="#000"/>
        <circle cx="39" cy="25" r="3" fill="#000"/>
        <path d="M25,40 Q32,45 39,40" stroke="#000" stroke-width="2" fill="none"/>
        <text x="32" y="55" text-anchor="middle" font-size="8" fill="#000">Scrocca</text>
      </svg>`,leprecauno:`<svg width="64" height="64" xmlns="http://www.w3.org/2000/svg">
        <circle cx="32" cy="32" r="25" fill="#32CD32" stroke="#000" stroke-width="2"/>
        <circle cx="25" cy="25" r="3" fill="#000"/>
        <circle cx="39" cy="25" r="3" fill="#000"/>
        <path d="M25,40 Q32,45 39,40" stroke="#000" stroke-width="2" fill="none"/>
        <text x="32" y="55" text-anchor="middle" font-size="6" fill="#000">Leprecauno</text>
      </svg>`};if(e[t]){const i="data:image/svg+xml;base64,"+btoa(e[t]);this.load.image(t,i)}}}const y={en:{title:"Etimu√® Bottle Dropper",subtitle:"Catch the falling bottles!",version:"v2.0.0 - Clean Architecture",newGame:"New Game",pause:"Pause",resume:"Resume",instructions:"Instructions",footerMadeBy:"Made with ‚ù§Ô∏è by Etimu√®",footerControls:"Use arrow keys or mouse to control the bucket",instructionsTitle:"üéÆ How to Play:",instructionsObjective:"üéØ Objective: Catch falling bottles with your bucket!",instructionsControls:"üïπÔ∏è Controls:",instructionsRules:"üç∂ Game Rules:",instructionsTips:"üèÜ Tips:",instructionsGoodLuck:"Good luck! üéÆ",instructionsArrowKeys:"‚Ä¢ Use ‚Üê ‚Üí arrow keys to move",instructionsMouseDrag:"‚Ä¢ Or click and drag with mouse/touch",instructionsMobileTouch:"‚Ä¢ On mobile: Use touch controls at bottom",instructionsBrownBottles:"‚Ä¢ Brown bottles: +1 point each",instructionsGreenBottles:"‚Ä¢ Green bottles: Lose 1 life (unless All Good mode)",instructionsStarPowerups:"‚Ä¢ ‚≠ê Star power-ups: Activate All Good mode",instructionsLives:"‚Ä¢ üíó You have 3 lives",instructionsTimer:"‚Ä¢ ‚è∞ 60 seconds to play",instructionsCatchStars:"‚Ä¢ Catch star power-ups to avoid green bottle damage",instructionsAllGoodMode:"‚Ä¢ All Good mode makes green bottles worth +1 point",instructionsHighScore:"‚Ä¢ Try to get the highest score possible!",score:"Score",lives:"Lives",time:"Time",allGood:"ALL GOOD",gameInstructions:"Use arrow keys or drag to move the bucket!",gameRules:"üç∂ Catch brown bottles: +1pt | üü¢ Avoid green bottles: -1 life | ‚≠ê Star: All Good!",gameOver:"GAME OVER!",finalScore:"Final Score",restartMessage:'Click "New Game" to restart',authWelcome:"üéÆ Welcome to Etimu√® Bottle Dropper!",authSignInToPlay:"Sign in to play and compete for prizes",authContinueGoogle:"Continue with Google",authContinueEmail:"Continue with Email",authEmailTitle:"üìß Sign in with Email",authEmailSubtitle:"We'll send you a verification code",authSendCode:"Send Code",authBack:"‚Üê Back",authVerifyTitle:"üîê Enter Verification Code",authVerifySubtitle:"Check your email for the 6-digit code",authVerify:"Verify",authProfileTitle:"üë§ Setup Your Profile",authProfileSubtitle:"Choose a nickname for the leaderboard",authNicknamePlaceholder:"Your nickname",authMarketingConsent:"I want to receive updates and compete for prizes",authStartPlaying:"Start Playing!",authProcessing:"Processing...",authEmailPlaceholder:"your@email.com",authOtpPlaceholder:"000000",authInvalidEmail:"Please enter a valid email address",authCodeSent:"Verification code sent to your email!",authInvalidCode:"Invalid verification code",authCodeLength:"Please enter the 6-digit verification code",authFailed:"Authentication failed, please try again",authUnexpectedError:"Unexpected error during authentication",authGoogleFailed:"Google sign in failed",authSendFailed:"Failed to send verification code",authVerifyFailed:"Unexpected error during verification",authProfileFailed:"Failed to update profile",footerControlsCharacter:"Use arrow keys or mouse to control {character}",characterCharlie:"Charlie",characterScrocca:"Scrocca",characterLeprecauno:"Leprechaun"},it:{title:"Etimu√® Bottle Dropper",subtitle:"Prendi le bottiglie che cadono!",version:"v2.0.0 - Architettura Pulita",newGame:"Nuova Partita",pause:"Pausa",resume:"Riprendi",instructions:"Istruzioni",footerMadeBy:"Fatto con ‚ù§Ô∏è da Etimu√®",footerControls:"Usa le frecce o il mouse per controllare il secchio",instructionsTitle:"üéÆ Come Giocare:",instructionsObjective:"üéØ Obiettivo: Prendi le bottiglie che cadono con il tuo secchio!",instructionsControls:"üïπÔ∏è Controlli:",instructionsRules:"üç∂ Regole del Gioco:",instructionsTips:"üèÜ Suggerimenti:",instructionsGoodLuck:"Buona fortuna! üéÆ",instructionsArrowKeys:"‚Ä¢ Usa le frecce ‚Üê ‚Üí per muoverti",instructionsMouseDrag:"‚Ä¢ Oppure clicca e trascina con mouse/touch",instructionsMobileTouch:"‚Ä¢ Su mobile: Usa i controlli touch in basso",instructionsBrownBottles:"‚Ä¢ Bottiglie marroni: +1 punto ciascuna",instructionsGreenBottles:"‚Ä¢ Bottiglie verdi: Perdi 1 vita (tranne in modalit√† All Good)",instructionsStarPowerups:"‚Ä¢ ‚≠ê Power-up stella: Attiva modalit√† All Good",instructionsLives:"‚Ä¢ üíó Hai 3 vite",instructionsTimer:"‚Ä¢ ‚è∞ 60 secondi per giocare",instructionsCatchStars:"‚Ä¢ Prendi i power-up stella per evitare danni dalle bottiglie verdi",instructionsAllGoodMode:"‚Ä¢ La modalit√† All Good rende le bottiglie verdi del valore di +1 punto",instructionsHighScore:"‚Ä¢ Cerca di ottenere il punteggio pi√π alto possibile!",score:"Punteggio",lives:"Vite",time:"Tempo",allGood:"ALL GOOD",gameInstructions:"Usa le frecce o trascina per muovere il secchio!",gameRules:"üç∂ Prendi bottiglie marroni: +1pt | üü¢ Evita bottiglie verdi: -1 vita | ‚≠ê Stella: All Good!",gameOver:"GAME OVER!",finalScore:"Punteggio Finale",restartMessage:'Clicca "Nuova Partita" per ricominciare',authWelcome:"üéÆ Benvenuto su Etimu√® Bottle Dropper!",authSignInToPlay:"Accedi per giocare e competere per i premi",authContinueGoogle:"Continua con Google",authContinueEmail:"Continua con Email",authEmailTitle:"üìß Accedi con Email",authEmailSubtitle:"Ti invieremo un codice di verifica",authSendCode:"Invia Codice",authBack:"‚Üê Indietro",authVerifyTitle:"üîê Inserisci Codice di Verifica",authVerifySubtitle:"Controlla la tua email per il codice a 6 cifre",authVerify:"Verifica",authProfileTitle:"üë§ Configura il Tuo Profilo",authProfileSubtitle:"Scegli un nickname per la classifica",authNicknamePlaceholder:"Il tuo nickname",authMarketingConsent:"Voglio ricevere aggiornamenti e competere per i premi",authStartPlaying:"Inizia a Giocare!",authProcessing:"Elaborazione...",authEmailPlaceholder:"tua@email.com",authOtpPlaceholder:"000000",authInvalidEmail:"Inserisci un indirizzo email valido",authCodeSent:"Codice di verifica inviato alla tua email!",authInvalidCode:"Codice di verifica non valido",authCodeLength:"Inserisci il codice di verifica a 6 cifre",authFailed:"Autenticazione fallita, riprova",authUnexpectedError:"Errore imprevisto durante l'autenticazione",authGoogleFailed:"Accesso con Google fallito",authSendFailed:"Invio del codice di verifica fallito",authVerifyFailed:"Errore imprevisto durante la verifica",authProfileFailed:"Aggiornamento del profilo fallito",footerControlsCharacter:"Usa le frecce o il mouse per controllare {character}",characterCharlie:"Charlie",characterScrocca:"Scrocca",characterLeprecauno:"Leprecauno"}},m=class m{constructor(){n(this,"currentLanguage","en");n(this,"callbacks",new Set);const t=localStorage.getItem("etimue-language"),e=navigator.language.toLowerCase();t&&t in y?this.currentLanguage=t:e.startsWith("it")?this.currentLanguage="it":this.currentLanguage="en",console.log(`üåç Language initialized: ${this.currentLanguage}`)}static getInstance(){return m.instance||(m.instance=new m),m.instance}getCurrentLanguage(){return this.currentLanguage}setLanguage(t){t!==this.currentLanguage&&t in y&&(this.currentLanguage=t,localStorage.setItem("etimue-language",t),console.log(`üåç Language changed to: ${t}`),this.callbacks.forEach(e=>e(t)))}getTranslation(){return y[this.currentLanguage]}translate(t){return y[this.currentLanguage][t]}onLanguageChange(t){this.callbacks.add(t)}offLanguageChange(t){this.callbacks.delete(t)}toggleLanguage(){const t=this.currentLanguage==="en"?"it":"en";this.setLanguage(t)}getAvailableLanguages(){return Object.keys(y)}getLanguageDisplayName(t){switch(t){case"en":return"English";case"it":return"Italiano";default:return t}}};n(m,"instance");let E=m;const c=E.getInstance(),f=class f{constructor(){n(this,"currentCharacter","charlie");n(this,"callbacks",new Set);let t=localStorage.getItem("etimue-character");t==="irlandese"&&(t="leprecauno",localStorage.setItem("etimue-character",t),console.log("üîÑ Migrated character from 'irlandese' to 'leprecauno'")),t&&this.isValidCharacter(t)&&(this.currentCharacter=t),console.log(`üê± Character initialized: ${this.currentCharacter}`)}static getInstance(){return f.instance||(f.instance=new f),f.instance}isValidCharacter(t){return["charlie","scrocca","leprecauno"].includes(t)}getCurrentCharacter(){return this.currentCharacter}setCharacter(t){t!==this.currentCharacter&&this.isValidCharacter(t)&&(this.currentCharacter=t,localStorage.setItem("etimue-character",t),console.log(`üê± Character changed to: ${t}`),this.callbacks.forEach(e=>e(t)))}getCharacterInfo(t){const e=t||this.currentCharacter,i=c.getTranslation();switch(e){case"charlie":return{id:"charlie",name:i.characterCharlie,sprite:"charlie",description:"Punk cat with attitude"};case"scrocca":return{id:"scrocca",name:i.characterScrocca,sprite:"scrocca",description:"Party cat who loves fun"};case"leprecauno":return{id:"leprecauno",name:i.characterLeprecauno,sprite:"leprecauno",description:"Lucky Irish leprechaun cat"};default:return this.getCharacterInfo("charlie")}}getCurrentCharacterName(){return this.getCharacterInfo().name}getAllCharacters(){return["charlie","scrocca","leprecauno"].map(t=>this.getCharacterInfo(t))}onCharacterChange(t){this.callbacks.add(t)}offCharacterChange(t){this.callbacks.delete(t)}cycleCharacter(){const t=["charlie","scrocca","leprecauno"],i=(t.indexOf(this.currentCharacter)+1)%t.length;this.setCharacter(t[i])}};n(f,"instance");let k=f;const g=k.getInstance();class D extends A.Scene{constructor(){super({key:"GameScene"});n(this,"character");n(this,"bottles");n(this,"powerups");n(this,"score",0);n(this,"lives",3);n(this,"timeLeft",60);n(this,"scoreText");n(this,"livesText");n(this,"timerText");n(this,"powerupText");n(this,"instructionsText");n(this,"rulesText");n(this,"languageChangeCallback");n(this,"spawnTimer");n(this,"powerupTimer");n(this,"gameTimer");n(this,"allGoodTimer");n(this,"gameStarted",!1);n(this,"gameOver",!1);n(this,"allGoodMode",!1);n(this,"allGoodTimeLeft",0);n(this,"gameOverTexts",[])}create(){console.log("üéÆ GameScene: Initializing game...");const{width:e,height:i}=this.cameras.main;this.add.image(e/2,i/2,"background"),this.setupUI(),this.setupGameObjects(),this.setupInput(),this.setupCollisions(),this.cameras.main.fadeIn(300,0,0,0),console.log("‚úÖ GameScene: Ready to play!")}setupUI(){const{width:e,height:i}=this.cameras.main,r=c.getTranslation();this.scoreText=this.add.text(16,16,`${r.score}: 0`,{fontSize:"24px",color:"#000000",fontFamily:"Arial"}),this.livesText=this.add.text(16,50,`${r.lives}: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è`,{fontSize:"20px",color:"#000000",fontFamily:"Arial"}),this.timerText=this.add.text(e/2,16,`${r.time}: 60s`,{fontSize:"24px",color:"#000000",fontFamily:"Arial"}).setOrigin(.5),this.powerupText=this.add.text(e-16,16,"",{fontSize:"18px",color:"#FFD700",fontFamily:"Arial"}).setOrigin(1,0),this.instructionsText=this.add.text(e/2,i*.12,r.gameInstructions,{fontSize:Math.min(18,e*.025)+"px",color:"#000000",fontFamily:"Arial"}).setOrigin(.5),this.rulesText=this.add.text(e/2,i*.16,r.gameRules,{fontSize:Math.min(14,e*.018)+"px",color:"#333333",fontFamily:"Arial"}).setOrigin(.5),this.languageChangeCallback=()=>{this.updateUITexts()},c.onLanguageChange(this.languageChangeCallback)}updateUITexts(){const e=c.getTranslation();this.scoreText.setText(`${e.score}: ${this.score}`);const i="‚ù§Ô∏è".repeat(this.lives);this.livesText.setText(`${e.lives}: ${i}`),this.timerText.setText(`${e.time}: ${this.timeLeft}s`),this.instructionsText.setText(e.gameInstructions),this.rulesText.setText(e.gameRules),this.allGoodMode&&this.powerupText.setText(`‚≠ê ${e.allGood}: ${this.allGoodTimeLeft}s`)}setupGameObjects(){const{width:e,height:i}=this.cameras.main,r=g.getCurrentCharacter();this.character=this.physics.add.image(e/2,i-80,r),this.character.setCollideWorldBounds(!0),this.character.setImmovable(!0),this.character.setScale(.6),g.onCharacterChange(a=>{this.character&&(this.character.setTexture(a),console.log(`üê± Character sprite updated to: ${a}`))}),this.bottles=this.physics.add.group({defaultKey:"bottle",maxSize:15}),this.powerups=this.physics.add.group({defaultKey:"powerup_star",maxSize:3})}setupInput(){var e;(e=this.input.keyboard)==null||e.createCursorKeys(),this.input.on("pointermove",i=>{if(i.isDown){const{width:r}=this.cameras.main,a=Math.max(40,r*.05);this.character.x=Phaser.Math.Clamp(i.x,a,r-a)}}),this.input.on("pointerdown",()=>{this.gameOver||this.startGame()})}setupCollisions(){this.physics.add.overlap(this.character,this.bottles,this.catchBottle,void 0,this),this.physics.add.overlap(this.character,this.powerups,this.catchPowerup,void 0,this)}startGame(){if(this.gameStarted)return;this.gameOverTexts.forEach(i=>i.destroy()),this.gameOverTexts=[],this.lives=3,this.score=0,this.timeLeft=60,this.gameOver=!1,this.allGoodMode=!1,this.allGoodTimeLeft=0,this.updateLivesDisplay();const e=c.getTranslation();this.scoreText.setText(`${e.score}: ${this.score}`),this.timerText.setText(`${e.time}: ${this.timeLeft}s`),this.powerupText.setText(""),this.gameStarted=!0,console.log("üöÄ GAME START DEBUG (RESET):"),console.log(`üíó Starting Lives: ${this.lives}`),console.log(`üéØ Starting Score: ${this.score}`),console.log(`‚è∞ Starting Time: ${this.timeLeft}s`),console.log(`‚≠ê All Good Mode: ${this.allGoodMode}`),this.spawnTimer=this.time.addEvent({delay:1e3,callback:this.spawnBottle,callbackScope:this,loop:!0}),this.scheduleNextPowerup(),this.gameTimer=this.time.addEvent({delay:1e3,callback:this.updateTimer,callbackScope:this,loop:!0})}spawnBottle(){if(this.gameOver)return;const{width:e}=this.cameras.main,i=60,r=e-60,a=Phaser.Math.Between(i,r),s=Math.random()<.2,h=this.bottles.get(a,-50,"bottle");h&&(h.setActive(!0),h.setVisible(!0),s?(h.setTexture("bottle_green"),console.log(`üü¢ GREEN bottle spawned at x:${a}`)):(h.setTexture("bottle"),console.log(`üç∂ BROWN bottle spawned at x:${a}`)),h.body.velocity.y=200,h.body.velocity.x=Phaser.Math.Between(-50,50),h.body.setCollideWorldBounds(!0),h.body.setBounce(0),h.setData("checkGround",!0),h.setData("isGreen",s))}scheduleNextPowerup(){if(this.gameOver)return;const e=5e3,i=3e4,r=Math.random(),a=Math.pow(r,1.5),s=e+(i-e)*a;console.log(`‚≠ê Next power-up scheduled in ${(s/1e3).toFixed(1)}s`),this.powerupTimer=this.time.addEvent({delay:s,callback:()=>{this.spawnPowerup(),this.scheduleNextPowerup()},callbackScope:this})}spawnPowerup(){if(this.gameOver)return;const{width:e}=this.cameras.main,i=80,r=e-80,a=Phaser.Math.Between(i,r),s=this.powerups.get(a,-30,"powerup_star");if(s){s.setActive(!0),s.setVisible(!0);const h=Phaser.Math.Between(120,180),l=Phaser.Math.Between(-30,30);s.body.velocity.y=h,s.body.velocity.x=l,s.body.setCollideWorldBounds(!0),s.body.setBounce(0),s.setData("checkGround",!0),console.log(`‚≠ê Power-up spawned at x:${a} with velocity(${l}, ${h})`)}}catchBottle(e,i){if(!i.active)return;const r=i.getData("isGreen");if(console.log("üéØ BOTTLE CATCH DEBUG:"),console.log(`üç∂ Bottle type: ${r?"GREEN (poison)":"BROWN (normal)"}`),console.log(`‚≠ê All Good Mode: ${this.allGoodMode}`),console.log(`üíó Lives before catch: ${this.lives}`),this.bottles.killAndHide(i),i.setActive(!1),i.setVisible(!1),r&&!this.allGoodMode)console.log("üö® GREEN BOTTLE CAUGHT WITHOUT ALL GOOD - LOSING LIFE!"),this.loseLife();else{this.score+=1;const a=c.getTranslation();this.scoreText.setText(`${a.score}: ${this.score}`),console.log(`‚úÖ ${r?"Green bottle (All Good active)":"Brown bottle"} caught! +1 point. Score: ${this.score}`)}}catchPowerup(e,i){i.active&&(console.log("‚≠ê POWERUP CATCH DEBUG:"),console.log(`üíó Lives before powerup: ${this.lives}`),this.powerups.killAndHide(i),i.setActive(!1),i.setVisible(!1),this.activateAllGoodMode(),console.log(`‚úÖ Power-up caught! All Good mode activated! Lives unchanged: ${this.lives}`))}loseLife(){if(this.gameOver)return;const e=new Error().stack;console.warn("üö® LIFE LOST DEBUG:"),console.warn(`üíî Lives before: ${this.lives}`),console.warn("üîç Called from:",e==null?void 0:e.split(`
`).slice(1,4)),console.warn(`‚≠ê All Good Mode: ${this.allGoodMode}`),this.lives-=1,this.updateLivesDisplay(),console.warn(`üíî Lives after: ${this.lives}`),this.lives<=0&&(console.warn("‚ò†Ô∏è GAME OVER - No lives remaining"),this.endGame())}updateLivesDisplay(){const e="‚ù§Ô∏è".repeat(this.lives),i=c.getTranslation();this.livesText.setText(`${i.lives}: ${e}`)}updateTimer(){if(this.gameOver)return;this.timeLeft-=1;const e=c.getTranslation();this.timerText.setText(`${e.time}: ${this.timeLeft}s`),this.timeLeft<=0&&this.endGame()}activateAllGoodMode(){this.allGoodMode=!0,this.allGoodTimeLeft=10;const e=c.getTranslation();this.powerupText.setText(`‚≠ê ${e.allGood}: ${this.allGoodTimeLeft}s`),this.allGoodTimer&&this.allGoodTimer.destroy(),this.allGoodTimer=this.time.addEvent({delay:1e3,callback:this.updateAllGoodMode,callbackScope:this,loop:!0})}updateAllGoodMode(){if(!this.allGoodMode)return;this.allGoodTimeLeft-=1;const e=c.getTranslation();this.powerupText.setText(`‚≠ê ${e.allGood}: ${this.allGoodTimeLeft}s`),this.allGoodTimeLeft<=0&&this.deactivateAllGoodMode()}deactivateAllGoodMode(){this.allGoodMode=!1,this.allGoodTimeLeft=0,this.powerupText.setText(""),this.allGoodTimer&&this.allGoodTimer.destroy(),console.log("‚≠ê All Good mode deactivated")}endGame(){this.gameOver=!0,this.gameStarted=!1,this.spawnTimer&&this.spawnTimer.destroy(),this.powerupTimer&&this.powerupTimer.destroy(),this.gameTimer&&this.gameTimer.destroy(),this.allGoodTimer&&this.allGoodTimer.destroy(),this.deactivateAllGoodMode();const{width:e,height:i}=this.cameras.main,r=c.getTranslation(),a=this.add.text(e/2,i/2,r.gameOver,{fontSize:Math.min(48,e*.06)+"px",color:"#ff0000",fontFamily:"Arial"}).setOrigin(.5),s=this.add.text(e/2,i/2+50,`${r.finalScore}: ${this.score}`,{fontSize:Math.min(24,e*.03)+"px",color:"#000000",fontFamily:"Arial"}).setOrigin(.5),h=this.add.text(e/2,i/2+100,r.restartMessage,{fontSize:Math.min(18,e*.025)+"px",color:"#666666",fontFamily:"Arial"}).setOrigin(.5);this.gameOverTexts.push(a,s,h),console.log(`üéÆ Game Over! Final Score: ${this.score}`)}update(){var a,s,h;if(this.gameOver)return;const{width:e,height:i}=this.cameras.main,r=(a=this.input.keyboard)==null?void 0:a.createCursorKeys();if(r){const l=Math.max(40,e*.05),G=Math.max(5,e*.006);(s=r.left)!=null&&s.isDown?this.character.x=Math.max(l,this.character.x-G):(h=r.right)!=null&&h.isDown&&(this.character.x=Math.min(e-l,this.character.x+G))}this.bottles.children.entries.forEach(l=>{if(l.active&&l.getData("checkGround")&&l.y>=i-20){const G=l.getData("isGreen");console.log(`üåç GROUND HIT: ${G?"GREEN":"BROWN"} bottle hit ground - NO LIFE LOSS`),this.bottles.killAndHide(l),l.setActive(!1),l.setVisible(!1)}}),this.powerups.children.entries.forEach(l=>{l.active&&l.getData("checkGround")&&l.y>=i-20&&(this.powerups.killAndHide(l),l.setActive(!1),l.setVisible(!1))})}shutdown(){this.spawnTimer&&this.spawnTimer.destroy(),this.powerupTimer&&this.powerupTimer.destroy(),this.gameTimer&&this.gameTimer.destroy(),this.allGoodTimer&&this.allGoodTimer.destroy(),this.languageChangeCallback&&c.offLanguageChange(this.languageChangeCallback)}}const F={type:Phaser.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#87CEEB",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,min:{width:300,height:400},max:{width:1200,height:900}},physics:{default:"arcade",arcade:{gravity:{x:0,y:300},debug:!1}},scene:[$,D]};let d=null,w=!1;function N(){return w?(console.warn("üîÑ Game initialization already in progress, returning existing instance"),d):(d&&(console.log("üîÑ Destroying existing game instance before creating new one"),w=!0,d.destroy(!0),setTimeout(()=>{w=!1},100)),w=!0,d=new A.Game(F),w=!1,console.log("‚úÖ Game initialized successfully"),d)}function P(){return d}function U(){d&&(d.destroy(!0),d=null)}const C={}.VITE_SUPABASE_URL,T={}.VITE_SUPABASE_ANON_KEY;console.log("üîç Environment check:",{url:C?"SET":"MISSING",key:T?"SET":"MISSING",env:{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}});if(!C||!T)throw console.error("‚ùå Missing env vars:",{supabaseUrl:C,supabaseAnonKey:T}),new Error(`Missing Supabase environment variables: URL=${!!C}, KEY=${!!T}`);const u=M(C,T,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"}}),b={async getProfile(o){try{const{data:t,error:e}=await u.from("profiles").select("*").eq("id",o).maybeSingle();return e?(console.error("Error fetching profile:",e),null):t}catch(t){return console.error("Profile fetch exception:",t),null}},async createProfile(o){try{const{data:t,error:e}=await u.from("profiles").upsert(o,{onConflict:"id",ignoreDuplicates:!1}).select().single();return e?(console.error("Error creating profile:",e),null):t}catch(t){return console.error("Profile creation exception:",t),null}},async updateProfile(o,t){try{const{data:e,error:i}=await u.from("profiles").update(t).eq("id",o).select().single();return i?(console.error("Error updating profile:",i),null):e}catch(e){return console.error("Profile update exception:",e),null}},async checkNicknameAvailability(o,t){try{if(!o||o.trim().length===0)return!0;const e=u.from("profiles").select("id").eq("nickname",o.trim());t&&e.neq("id",t);const{data:i,error:r}=await e;return r?(console.error("Error checking nickname availability:",r),!1):i.length===0}catch(e){return console.error("Nickname availability check exception:",e),!1}}};class R{constructor(){n(this,"state",{user:null,profile:null,session:null,isLoading:!0,isAuthenticated:!1,hasMarketingConsent:!1});n(this,"listeners",[]);n(this,"isProcessingAuth",!1);this.initializeAuth(),this.setupAuthListeners()}async initializeAuth(){try{console.log("üîÑ Initializing auth...");const t=u.auth.getSession(),e=new Promise((a,s)=>setTimeout(()=>s(new Error("Session timeout")),5e3)),{data:{session:i},error:r}=await Promise.race([t,e]);r&&console.error("Error getting session:",r),i?(console.log("‚úÖ Session found, processing auth..."),await this.handleAuthChange(i)):console.log("‚ÑπÔ∏è No active session")}catch(t){console.error("Auth initialization error:",t)}finally{this.state.isLoading=!1,this.notifyListeners(),console.log("‚úÖ Auth initialization complete")}}setupAuthListeners(){u.auth.onAuthStateChange(async(t,e)=>{switch(console.log("üîÑ Auth state change:",t),t){case"SIGNED_IN":e&&await this.handleAuthChange(e);break;case"SIGNED_OUT":this.resetAuthState();break;case"TOKEN_REFRESHED":e&&(this.state.session=e,this.state.user=e.user);break}this.notifyListeners()})}async handleAuthChange(t){var e,i;if(this.isProcessingAuth){console.log("‚è≥ Already processing auth, skipping...");return}this.isProcessingAuth=!0;try{console.log("üë§ Processing auth for user:",t.user.email),this.state.session=t,this.state.user=t.user,this.state.isAuthenticated=!0;let r=await b.getProfile(t.user.id);r||(console.log("üìù Creating new profile..."),r=await b.createProfile({email:t.user.email||"",nickname:((e=t.user.user_metadata)==null?void 0:e.name)||((i=t.user.user_metadata)==null?void 0:i.full_name)||null,consent_marketing:!1,consent_timestamp:null})),this.state.profile=r,this.state.hasMarketingConsent=(r==null?void 0:r.consent_marketing)||!1,console.log("‚úÖ Auth processing complete:",{email:t.user.email,hasProfile:!!r,hasConsent:this.state.hasMarketingConsent})}catch(r){console.error("‚ùå Error processing auth:",r)}finally{this.state.isLoading=!1,this.isProcessingAuth=!1}}resetAuthState(){this.state={user:null,profile:null,session:null,isLoading:!1,isAuthenticated:!1,hasMarketingConsent:!1}}notifyListeners(){this.listeners.forEach(t=>{try{t(this.state)}catch(e){console.error("Error in auth listener:",e)}})}subscribe(t){return this.listeners.push(t),t(this.state),()=>{const e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)}}getState(){return{...this.state}}isReady(){return!this.state.isLoading}canPlayGame(){return this.state.isAuthenticated}canCompeteForPrizes(){return this.state.isAuthenticated&&this.state.hasMarketingConsent}async signInWithGoogle(){try{const e=window.location.origin==="http://localhost:3000"?"http://localhost:3000":"https://etimuebottledropper.netlify.app";console.log("üîê Starting Google OAuth with redirect to:",e);const{error:i}=await u.auth.signInWithOAuth({provider:"google",options:{redirectTo:e,queryParams:{access_type:"offline",prompt:"consent"}}});return i?(console.error("Google sign in error:",i),{success:!1,error:i.message}):{success:!0}}catch(t){return console.error("Google sign in exception:",t),{success:!1,error:"Unexpected error during sign in"}}}async signInWithOTP(t){try{const{error:e}=await u.auth.signInWithOtp({email:t});return e?(console.error("OTP sign in error:",e),{success:!1,error:e.message}):{success:!0}}catch(e){return console.error("OTP sign in exception:",e),{success:!1,error:"Unexpected error during sign in"}}}async verifyOTP(t,e){try{const{error:i}=await u.auth.verifyOtp({email:t,token:e,type:"email"});return i?(console.error("OTP verification error:",i),{success:!1,error:i.message}):{success:!0}}catch(i){return console.error("OTP verification exception:",i),{success:!1,error:"Unexpected error during verification"}}}async signOut(){try{const{error:t}=await u.auth.signOut();if(t)throw t}catch(t){throw console.error("Sign out error:",t),t}}async updateProfile(t){if(!this.state.user)throw new Error("No authenticated user");try{const e=await b.updateProfile(this.state.user.id,t);return e&&(this.state.profile=e,"consent_marketing"in t&&(this.state.hasMarketingConsent=e.consent_marketing),this.notifyListeners()),e}catch(e){throw console.error("Profile update error:",e),e}}async refreshProfile(){if(this.state.user)try{const t=await b.getProfile(this.state.user.id);t&&(this.state.profile=t,this.state.hasMarketingConsent=t.consent_marketing,this.notifyListeners())}catch(t){console.error("Profile refresh error:",t)}}destroy(){this.listeners=[]}}const p=new R,z=async()=>{if(console.log("üéÆ Checking auth for game access..."),p.canPlayGame())return console.log("‚úÖ User can play!"),!0;if(p.isReady()||(console.log("‚è≥ Waiting for auth to initialize..."),await new Promise(t=>{const e=p.subscribe(i=>{i.isLoading||(e(),t())})})),!p.canPlayGame())return console.log("üîê Showing auth modal..."),new Promise(t=>{B(()=>import("./AuthModal-27675ace.js"),["assets/AuthModal-27675ace.js","assets/phaser-f8c8a439.js","assets/supabase-2481e69c.js"]).then(({AuthModal:e})=>{const i=new e;i.onAuth(r=>{i.destroy(),t(r&&p.canPlayGame())}),i.show()}).catch(e=>{console.error("Failed to load AuthModal:",e),t(!1)})});const o=p.canPlayGame();return console.log("üéØ Final auth check result:",o),o};let S=!1;function V(){function o(){const e=c.getTranslation();document.querySelectorAll("[data-i18n]").forEach(a=>{const s=a.getAttribute("data-i18n");s&&s in e&&(s==="footerControls"?t():a.textContent=e[s])});const i=document.getElementById("language-btn");if(i){const a=c.getCurrentLanguage();i.textContent=`üåç ${a.toUpperCase()}`}const r=document.getElementById("character-btn");if(r){const a=g.getCurrentCharacterName();r.textContent=`üê± ${a}`}document.documentElement.lang=c.getCurrentLanguage()}function t(){const e=document.querySelector('[data-i18n="footerControls"]');if(e){const i=c.getTranslation(),r=g.getCurrentCharacterName();e.textContent=i.footerControlsCharacter.replace("{character}",r)}}c.onLanguageChange(o),g.onCharacterChange(()=>{t();const e=document.getElementById("character-btn");if(e){const i=g.getCurrentCharacterName();e.textContent=`üê± ${i}`}}),o()}window.startNewGame=async function(){if(console.log("üéÆ Starting new game..."),!await z()){console.log("‚ùå User not authenticated, game start cancelled");return}console.log("‚úÖ User authenticated, starting game..."),P()&&(console.log("üîÑ Destroying existing game instance"),U()),N()};window.togglePause=function(){const o=P();if(o)if(S=!S,S){o.scene.pause("GameScene");const t=c.getTranslation();document.querySelector(".btn:nth-child(2)").textContent="‚ñ∂Ô∏è "+t.resume,console.log("‚è∏Ô∏è Game paused")}else{o.scene.resume("GameScene");const t=c.getTranslation();document.querySelector(".btn:nth-child(2)").textContent="‚è∏Ô∏è "+t.pause,console.log("‚ñ∂Ô∏è Game resumed")}};window.showInstructions=function(){const o=document.getElementById("instructions-modal");o&&(o.style.display="block",console.log("üìñ Instructions modal opened"))};window.closeInstructions=function(){const o=document.getElementById("instructions-modal");o&&(o.style.display="none",console.log("üìñ Instructions modal closed"))};window.onclick=function(o){const t=document.getElementById("instructions-modal");o.target===t&&closeInstructions()};window.toggleLanguage=function(){c.toggleLanguage(),console.log(`üåç Language toggled to: ${c.getCurrentLanguage()}`)};window.cycleCharacter=function(){g.cycleCharacter(),console.log(`üê± Character changed to: ${g.getCurrentCharacterName()}`)};let L=null,v=!1,x=!1;function _(){if(L=P(),!L)return;const o=L.scene.getScene("GameScene");if(o){if(v&&o.character){const{width:t}=o.cameras.main,e=Math.max(40,t*.05),i=Math.max(5,t*.006);o.character.x=Math.max(e,o.character.x-i)}if(x&&o.character){const{width:t}=o.cameras.main,e=Math.max(40,t*.05),i=Math.max(5,t*.006);o.character.x=Math.min(t-e,o.character.x+i)}}}document.addEventListener("DOMContentLoaded",function(){console.log("üöÄ Etimu√® Bottle Dropper v2.0.0 loaded!"),V();const o=document.getElementById("touch-left"),t=document.getElementById("touch-right");o&&t&&(o.addEventListener("touchstart",e=>{e.preventDefault(),v=!0}),o.addEventListener("touchend",e=>{e.preventDefault(),v=!1}),o.addEventListener("mousedown",e=>{e.preventDefault(),v=!0}),o.addEventListener("mouseup",e=>{e.preventDefault(),v=!1}),t.addEventListener("touchstart",e=>{e.preventDefault(),x=!0}),t.addEventListener("touchend",e=>{e.preventDefault(),x=!1}),t.addEventListener("mousedown",e=>{e.preventDefault(),x=!0}),t.addEventListener("mouseup",e=>{e.preventDefault(),x=!1}),setInterval(_,16))});export{p as a,c as l};
//# sourceMappingURL=index-605a4520.js.map
